/*
 * Copyright 2018 dialog LLC <info@dlg.im>
 * @flow
 */

declare var Status: {
  UNKNOWN: 0,
  OK: 1,
  CANCELLED: 2,
  INVALID_ARGUMENT: 3,
  DEADLINE_EXCEEDED: 4,
  NOT_FOUND: 5,
  ALREADY_EXISTS: 6,
  PERMISSION_DENIED: 7,
  UNAUTHENTICATED: 8,
  RESOURCE_EXHAUSTED: 9,
  FAILED_PRECONDITION: 10,
  ABORTED: 11,
  OUT_OF_RANGE: 12,
  UNIMPLEMENTED: 13,
  INTERNAL: 14,
  UNAVAILABLE: 15,
  DATA_LOSS: 16,
};

export type GrpcStatusName = $Keys<typeof Status>;
export type GrpcStatusCode = $Values<typeof Status>;

declare class IRequest {
  id: string;
  unary?: UnaryRequestBody;
  stream?: StreamRequestBody;
  push?: PushRequestBody;
  end?: EndRequestBody;
  cancel?: CancelRequestBody;
}

declare type RequestPayload =
  | {
      id: string,
      unary: UnaryRequestBody,
    }
  | {
      id: string,
      push: PushRequestBody,
    }
  | {
      id: string,
      stream: StreamRequestBody,
    }
  | {
      id: string,
      end: EndRequestBody,
    }
  | {
      id: string,
      cancel: CancelRequestBody,
    };

declare class Request extends IRequest {
  static encode(payload: RequestPayload): { finish(): Uint8Array };
  static decode(bytes: Uint8Array): Request;
}

export type UnaryRequestBody = {
  service: string,
  method: string,
  payload: Uint8Array,
  metadata: { [key: string]: string | Buffer },
};

export type PushRequestBody = {
  payload: Uint8Array,
};

export type StreamRequestBody = {};

export type EndRequestBody = {};

export type CancelRequestBody = {};

export type ErrorResponseBody = {
  status: GrpcStatusCode,
  message?: string,
};

declare class IResponse {
  id: string;
  unary?: UnaryResponseBody;
  push?: PushResponseBody;
  end?: EndResponseBody;
}

declare type ResponsePayload =
  | {
      id: string,
      unary: UnaryResponseBody,
    }
  | { id: string, push: PushResponseBody }
  | { id: string, end: EndResponseBody };

declare class Response extends IResponse {
  static encode(payload: ResponsePayload): { finish(): Uint8Array };
  static decode(bytes: Uint8Array): Response;
}

export type UnaryResponseBody = {
  payload: Uint8Array,
};

export type PushResponseBody = {
  payload: Uint8Array,
};

export type EndResponseBody = {};

module.exports = {
  Request,
  Response,
  Status,
};
